#ifdef USE_ENVMAP

	vec4 mPosition = objectMatrix * vec4( position, 1.0 );
	vec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;

	if ( useRefract ) {
		vReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );
	} else {
		vReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );
	}

#endif